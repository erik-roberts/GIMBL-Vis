function panelHandle = makePanelControls(pluginObj, parentHandle)
%% makePanelControls
%
% Input: parentHandle - handle for uicontrol parent

fontSize = pluginObj.fontSize;
fontHeight = pluginObj.fontHeight;
spacing = 2; % px
padding = 2; % px

uiControlsHandles = struct();

thisTag = pluginObj.panelTag('imagePanel');
imagePanel = uix.Panel(...
  'Tag',thisTag,...
  'Parent',parentHandle,...
  'Title','Image Window',...
  'FontUnits','points',...
  'FontSize',fontSize...
);

mainVbox = uix.VBox('Parent',imagePanel, 'Spacing',spacing, 'Padding',padding);

uiControlsHandles.parent = mainVbox;

% Row 1
% openImageButton
thisTag = pluginObj.panelTag('openWindowButton');
uiControlsHandles.openImageButton = uicontrol(...
  'Tag',thisTag,...
  'Style','pushbutton',...
  'FontUnits','points',...
  'FontSize',fontSize,...
  'String','Open Image Window',...
  'UserData',pluginObj.userData,...
  'Callback',pluginObj.callbackHandle(thisTag),...
  'Parent',mainVbox);

% Row 2
makeImageDirPathControls(mainVbox);

% Row 3
makeImageTypeControls(mainVbox);

% Row 4
makeImageRegexpControls(mainVbox);

panelHeight = fontHeight*2 + spacing + padding;
set(mainVbox, 'Heights',[panelHeight, panelHeight, panelHeight, panelHeight])

%% argout
panelHandle = uiControlsHandles;

%% notify listener
notify(pluginObj, 'panelControlsMade');


%% Nested fn
  function makeImageDirPathControls(parentHandle)
    thisHbox = uix.HBox('Parent',parentHandle, 'Spacing',spacing, 'Padding',padding);
    
    % imageDirLabel
    thisTag = pluginObj.panelTag('imageDirLabel');
    tooltipStr = 'Hint: use shebang parse notation for multiple directories, e.g. #!{''dir1'', ''dir2''}';
    uiControlsHandles.imagePathLabel = uicontrol(...
      'Tag',thisTag,...
      'Style','text',...
      'FontUnits','points',...
      'FontSize',fontSize,...
      'String','Image Dir(s):',...
      'TooltipString', tooltipStr,...
      'Parent',thisHbox);
    
    
    % imageDirBox
    thisTag = pluginObj.panelTag('imageDirBox');
    uiControlsHandles.delayValueBox = uicontrol(...
      'Tag',thisTag,...
      'Style','edit',...
      'FontUnits','points',...
      'FontSize',fontSize,...
      'String',pluginObj.controller.app.config.defaultImagePath,...
      'UserData',pluginObj.userData,...
      'Callback',pluginObj.callbackHandle(thisTag),...
      'Parent',thisHbox);
    
    set(thisHbox, 'Widths',[-1 -3]);
  end


  function makeImageTypeControls(parentHandle)
    thisHbox = uix.HBox('Parent',parentHandle, 'Spacing',spacing, 'Padding',padding);
    
    % imageTypeLabel
    thisTag = pluginObj.panelTag('imageTypeLabel');
    uiControlsHandles.imageTypeLabel = uicontrol(...
      'Tag',thisTag,...
      'Style','text',...
      'FontUnits','points',...
      'FontSize',fontSize,...
      'String','Image Type:',...
      'Parent',thisHbox);
    
    initialImageType = pluginObj.controller.app.config.initialImageType;
    if ~isempty(initialImageType)
      menuValue = find(strcmp(pluginObj.getImageTypes(), initialImageType));
      
      if length(menuValue) > 1
        menuValue = menuValue(1); % take first value
      elseif isempty(menuValue)
        menuValue = 1; % default to 1
      end
    end
    
    % imageTypeMenu
    thisTag = pluginObj.panelTag('imageTypeMenu');
    uiControlsHandles.imageTypeMenu = uicontrol(...
      'Tag',thisTag,...
      'Style','popupmenu',...
      'FontUnits','points',...
      'FontSize',fontSize,...
      'FontName','Monospaced',...
      'String',pluginObj.getImageTypes(),...
      'Value',menuValue,...
      'UserData',pluginObj.userData,...
      'Callback',pluginObj.callbackHandle(thisTag),...
      'Parent',thisHbox);
    
      set(thisHbox, 'Widths',[-1 -3]);
  end


  function makeImageRegexpControls(parentHandle)
    thisHbox = uix.HBox('Parent',parentHandle, 'Spacing',spacing, 'Padding',padding);
    
    imageRegexp = pluginObj.metadata.imageRegexp;
    if iscell(imageRegexp)
      % add string 's
      imageRegexp = cellfun(@(x) ['''' x ''''], imageRegexp, 'uni',0);
      
      % convert to string rep with shebang tag
      imageRegexp = ['#!{' strjoin(imageRegexp, ', ') '}'];
    end
    
    % imageRegexpLabel
    thisTag = pluginObj.panelTag('imageRegexpLabel');
    uiControlsHandles.imagePathLabel = uicontrol(...
      'Tag',thisTag,...
      'Style','text',...
      'FontUnits','points',...
      'FontSize',fontSize,...
      'String','Image Reg Expr:',...
      'Parent',thisHbox);
    
    
    % imageRegexpBox
    thisTag = pluginObj.panelTag('imageRegexpBox');
    uiControlsHandles.delayValueBox = uicontrol(...
      'Tag',thisTag,...
      'Style','edit',...
      'FontUnits','points',...
      'FontSize',fontSize,...
      'FontName','Monospaced',...
      'String',imageRegexp,...
      'UserData',pluginObj.userData,...
      'Callback',pluginObj.callbackHandle(thisTag),...
      'Parent',thisHbox);
    
    set(thisHbox, 'Widths',[-1 -3]);
  end
end
